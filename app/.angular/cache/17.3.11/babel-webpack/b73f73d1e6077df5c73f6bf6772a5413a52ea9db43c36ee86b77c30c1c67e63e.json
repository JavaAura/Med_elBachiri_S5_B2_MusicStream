{"ast":null,"code":"import _asyncToGenerator from \"/home/exshy/Documents/GitHub/Briefs/Angular/MusicStream/cursor_app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject } from 'rxjs';\nimport { db } from './db.service';\nimport * as i0 from \"@angular/core\";\nexport class TrackService {\n  constructor() {\n    this.tracksSubject = new BehaviorSubject([]);\n    this.tracks$ = this.tracksSubject.asObservable();\n    this.loadTracks();\n  }\n  loadTracks() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const tracks = yield db.tracks.toArray();\n        _this.tracksSubject.next(tracks);\n      } catch (error) {\n        console.error('Error loading tracks:', error);\n      }\n    })();\n  }\n  addTrack(trackData, audioFile) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const audioBlob = new Blob([audioFile], {\n          type: audioFile.type\n        });\n        // Create track entry\n        const track = {\n          ...trackData,\n          addedDate: new Date(),\n          duration: 0,\n          audioUrl: URL.createObjectURL(audioBlob)\n        };\n        // Save track metadata\n        const trackId = yield db.tracks.add(track);\n        // Save audio file\n        yield db.audioFiles.add({\n          trackId,\n          blob: audioBlob\n        });\n        yield _this2.loadTracks();\n      } catch (error) {\n        console.error('Error adding track:', error);\n        throw error;\n      }\n    })();\n  }\n  deleteTrack(trackId) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield db.tracks.delete(trackId);\n        yield db.audioFiles.where('trackId').equals(trackId).delete();\n        yield _this3.loadTracks();\n      } catch (error) {\n        console.error('Error deleting track:', error);\n        throw error;\n      }\n    })();\n  }\n  static {\n    this.ɵfac = function TrackService_Factory(t) {\n      return new (t || TrackService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TrackService,\n      factory: TrackService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","db","TrackService","constructor","tracksSubject","tracks$","asObservable","loadTracks","_this","_asyncToGenerator","tracks","toArray","next","error","console","addTrack","trackData","audioFile","_this2","audioBlob","Blob","type","track","addedDate","Date","duration","audioUrl","URL","createObjectURL","trackId","add","audioFiles","blob","deleteTrack","_this3","delete","where","equals","factory","ɵfac","providedIn"],"sources":["/home/exshy/Documents/GitHub/Briefs/Angular/MusicStream/cursor_app/src/app/core/services/track.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { db } from './db.service';\nimport { Track } from '../models/track.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TrackService {\n  private tracksSubject = new BehaviorSubject<Track[]>([]);\n  tracks$ = this.tracksSubject.asObservable();\n\n  constructor() {\n    this.loadTracks();\n  }\n\n  async loadTracks() {\n    try {\n      const tracks = await db.tracks.toArray();\n      this.tracksSubject.next(tracks);\n    } catch (error) {\n      console.error('Error loading tracks:', error);\n    }\n  }\n\n  async addTrack(trackData: Partial<Track>, audioFile: File): Promise<void> {\n    try {\n      const audioBlob = new Blob([audioFile], { type: audioFile.type });\n      \n      // Create track entry\n      const track: Track = {\n        ...trackData,\n        addedDate: new Date(),\n        duration: 0, // This should be calculated from the audio file\n        audioUrl: URL.createObjectURL(audioBlob)\n      } as Track;\n\n      // Save track metadata\n      const trackId = await db.tracks.add(track);\n\n      // Save audio file\n      await db.audioFiles.add({\n        trackId,\n        blob: audioBlob\n      });\n\n      await this.loadTracks();\n    } catch (error) {\n      console.error('Error adding track:', error);\n      throw error;\n    }\n  }\n\n  async deleteTrack(trackId: number): Promise<void> {\n    try {\n      await db.tracks.delete(trackId);\n      await db.audioFiles.where('trackId').equals(trackId).delete();\n      await this.loadTracks();\n    } catch (error) {\n      console.error('Error deleting track:', error);\n      throw error;\n    }\n  }\n} "],"mappings":";AACA,SAASA,eAAe,QAAoB,MAAM;AAClD,SAASC,EAAE,QAAQ,cAAc;;AAMjC,OAAM,MAAOC,YAAY;EAIvBC,YAAA;IAHQ,KAAAC,aAAa,GAAG,IAAIJ,eAAe,CAAU,EAAE,CAAC;IACxD,KAAAK,OAAO,GAAG,IAAI,CAACD,aAAa,CAACE,YAAY,EAAE;IAGzC,IAAI,CAACC,UAAU,EAAE;EACnB;EAEMA,UAAUA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MACd,IAAI;QACF,MAAMC,MAAM,SAAST,EAAE,CAACS,MAAM,CAACC,OAAO,EAAE;QACxCH,KAAI,CAACJ,aAAa,CAACQ,IAAI,CAACF,MAAM,CAAC;OAChC,CAAC,OAAOG,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;;IAC9C;EACH;EAEME,QAAQA,CAACC,SAAyB,EAAEC,SAAe;IAAA,IAAAC,MAAA;IAAA,OAAAT,iBAAA;MACvD,IAAI;QACF,MAAMU,SAAS,GAAG,IAAIC,IAAI,CAAC,CAACH,SAAS,CAAC,EAAE;UAAEI,IAAI,EAAEJ,SAAS,CAACI;QAAI,CAAE,CAAC;QAEjE;QACA,MAAMC,KAAK,GAAU;UACnB,GAAGN,SAAS;UACZO,SAAS,EAAE,IAAIC,IAAI,EAAE;UACrBC,QAAQ,EAAE,CAAC;UACXC,QAAQ,EAAEC,GAAG,CAACC,eAAe,CAACT,SAAS;SAC/B;QAEV;QACA,MAAMU,OAAO,SAAS5B,EAAE,CAACS,MAAM,CAACoB,GAAG,CAACR,KAAK,CAAC;QAE1C;QACA,MAAMrB,EAAE,CAAC8B,UAAU,CAACD,GAAG,CAAC;UACtBD,OAAO;UACPG,IAAI,EAAEb;SACP,CAAC;QAEF,MAAMD,MAAI,CAACX,UAAU,EAAE;OACxB,CAAC,OAAOM,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;QAC3C,MAAMA,KAAK;;IACZ;EACH;EAEMoB,WAAWA,CAACJ,OAAe;IAAA,IAAAK,MAAA;IAAA,OAAAzB,iBAAA;MAC/B,IAAI;QACF,MAAMR,EAAE,CAACS,MAAM,CAACyB,MAAM,CAACN,OAAO,CAAC;QAC/B,MAAM5B,EAAE,CAAC8B,UAAU,CAACK,KAAK,CAAC,SAAS,CAAC,CAACC,MAAM,CAACR,OAAO,CAAC,CAACM,MAAM,EAAE;QAC7D,MAAMD,MAAI,CAAC3B,UAAU,EAAE;OACxB,CAAC,OAAOM,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7C,MAAMA,KAAK;;IACZ;EACH;;;uBAtDWX,YAAY;IAAA;EAAA;;;aAAZA,YAAY;MAAAoC,OAAA,EAAZpC,YAAY,CAAAqC,IAAA;MAAAC,UAAA,EAFX;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}