{"ast":null,"code":"import _asyncToGenerator from \"/home/exshy/Documents/GitHub/Briefs/Angular/MusicStream/cursor_app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { from } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { db } from './db.service';\nimport * as i0 from \"@angular/core\";\nexport class TrackService {\n  constructor() {}\n  addTrack(track, audioFile) {\n    return _asyncToGenerator(function* () {\n      try {\n        // Validate track data\n        if (!track.title) {\n          throw new Error('Track title is required');\n        }\n        if (!track.artist) {\n          throw new Error('Artist name is required');\n        }\n        if (!track.category) {\n          throw new Error('Category is required');\n        }\n        if (!audioFile) {\n          throw new Error('Audio file is required');\n        }\n        // Validate file type\n        if (!audioFile.type.startsWith('audio/')) {\n          throw new Error('Invalid file type. Please upload an audio file.');\n        }\n        // Add track to database\n        const newTrack = {\n          ...track,\n          id: Date.now(),\n          addedDate: new Date().toISOString()\n        };\n        yield db.tracks.add(newTrack);\n        yield db.audioFiles.add({\n          trackId: newTrack.id,\n          blob: audioFile\n        });\n        console.log('Track added to database:', newTrack);\n        return newTrack;\n      } catch (error) {\n        console.error('Error in TrackService.addTrack:', error);\n        throw error;\n      }\n    })();\n  }\n  loadTracks() {\n    return from(db.tracks.toArray()).pipe(map(tracks => {\n      console.log('Loaded tracks:', tracks);\n      return tracks;\n    }), catchError(error => {\n      console.error('Error loading tracks:', error);\n      throw error;\n    }));\n  }\n  deleteTrack(trackId) {\n    return from(this.deleteTrackFromDb(trackId));\n  }\n  deleteTrackFromDb(trackId) {\n    return _asyncToGenerator(function* () {\n      yield db.tracks.delete(trackId);\n      yield db.audioFiles.where('trackId').equals(trackId).delete();\n    })();\n  }\n  static {\n    this.ɵfac = function TrackService_Factory(t) {\n      return new (t || TrackService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TrackService,\n      factory: TrackService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["from","map","catchError","db","TrackService","constructor","addTrack","track","audioFile","_asyncToGenerator","title","Error","artist","category","type","startsWith","newTrack","id","Date","now","addedDate","toISOString","tracks","add","audioFiles","trackId","blob","console","log","error","loadTracks","toArray","pipe","deleteTrack","deleteTrackFromDb","delete","where","equals","factory","ɵfac","providedIn"],"sources":["/home/exshy/Documents/GitHub/Briefs/Angular/MusicStream/cursor_app/src/app/core/services/track.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { from, Observable } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { db } from './db.service';\nimport { Track } from '../models/track.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TrackService {\n  constructor() {}\n\n  async addTrack(track: Partial<Track>, audioFile: File): Promise<Track> {\n    try {\n      // Validate track data\n      if (!track.title) {\n        throw new Error('Track title is required');\n      }\n      if (!track.artist) {\n        throw new Error('Artist name is required');\n      }\n      if (!track.category) {\n        throw new Error('Category is required');\n      }\n      if (!audioFile) {\n        throw new Error('Audio file is required');\n      }\n\n      // Validate file type\n      if (!audioFile.type.startsWith('audio/')) {\n        throw new Error('Invalid file type. Please upload an audio file.');\n      }\n\n      // Add track to database\n      const newTrack: Track = {\n        ...track,\n        id: Date.now(),\n        addedDate: new Date().toISOString()\n      } as Track;\n\n      await db.tracks.add(newTrack);\n      await db.audioFiles.add({\n        trackId: newTrack.id,\n        blob: audioFile\n      });\n\n      console.log('Track added to database:', newTrack);\n      return newTrack;\n    } catch (error) {\n      console.error('Error in TrackService.addTrack:', error);\n      throw error;\n    }\n  }\n\n  loadTracks(): Observable<Track[]> {\n    return from(db.tracks.toArray()).pipe(\n      map(tracks => {\n        console.log('Loaded tracks:', tracks);\n        return tracks;\n      }),\n      catchError(error => {\n        console.error('Error loading tracks:', error);\n        throw error;\n      })\n    );\n  }\n\n  deleteTrack(trackId: number): Observable<void> {\n    return from(this.deleteTrackFromDb(trackId));\n  }\n\n  private async deleteTrackFromDb(trackId: number): Promise<void> {\n    await db.tracks.delete(trackId);\n    await db.audioFiles.where('trackId').equals(trackId).delete();\n  }\n} "],"mappings":";AACA,SAASA,IAAI,QAAoB,MAAM;AACvC,SAASC,GAAG,EAAEC,UAAU,QAAQ,gBAAgB;AAChD,SAASC,EAAE,QAAQ,cAAc;;AAMjC,OAAM,MAAOC,YAAY;EACvBC,YAAA,GAAe;EAETC,QAAQA,CAACC,KAAqB,EAAEC,SAAe;IAAA,OAAAC,iBAAA;MACnD,IAAI;QACF;QACA,IAAI,CAACF,KAAK,CAACG,KAAK,EAAE;UAChB,MAAM,IAAIC,KAAK,CAAC,yBAAyB,CAAC;;QAE5C,IAAI,CAACJ,KAAK,CAACK,MAAM,EAAE;UACjB,MAAM,IAAID,KAAK,CAAC,yBAAyB,CAAC;;QAE5C,IAAI,CAACJ,KAAK,CAACM,QAAQ,EAAE;UACnB,MAAM,IAAIF,KAAK,CAAC,sBAAsB,CAAC;;QAEzC,IAAI,CAACH,SAAS,EAAE;UACd,MAAM,IAAIG,KAAK,CAAC,wBAAwB,CAAC;;QAG3C;QACA,IAAI,CAACH,SAAS,CAACM,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;UACxC,MAAM,IAAIJ,KAAK,CAAC,iDAAiD,CAAC;;QAGpE;QACA,MAAMK,QAAQ,GAAU;UACtB,GAAGT,KAAK;UACRU,EAAE,EAAEC,IAAI,CAACC,GAAG,EAAE;UACdC,SAAS,EAAE,IAAIF,IAAI,EAAE,CAACG,WAAW;SACzB;QAEV,MAAMlB,EAAE,CAACmB,MAAM,CAACC,GAAG,CAACP,QAAQ,CAAC;QAC7B,MAAMb,EAAE,CAACqB,UAAU,CAACD,GAAG,CAAC;UACtBE,OAAO,EAAET,QAAQ,CAACC,EAAE;UACpBS,IAAI,EAAElB;SACP,CAAC;QAEFmB,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEZ,QAAQ,CAAC;QACjD,OAAOA,QAAQ;OAChB,CAAC,OAAOa,KAAK,EAAE;QACdF,OAAO,CAACE,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;QACvD,MAAMA,KAAK;;IACZ;EACH;EAEAC,UAAUA,CAAA;IACR,OAAO9B,IAAI,CAACG,EAAE,CAACmB,MAAM,CAACS,OAAO,EAAE,CAAC,CAACC,IAAI,CACnC/B,GAAG,CAACqB,MAAM,IAAG;MACXK,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEN,MAAM,CAAC;MACrC,OAAOA,MAAM;IACf,CAAC,CAAC,EACFpB,UAAU,CAAC2B,KAAK,IAAG;MACjBF,OAAO,CAACE,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MAC7C,MAAMA,KAAK;IACb,CAAC,CAAC,CACH;EACH;EAEAI,WAAWA,CAACR,OAAe;IACzB,OAAOzB,IAAI,CAAC,IAAI,CAACkC,iBAAiB,CAACT,OAAO,CAAC,CAAC;EAC9C;EAEcS,iBAAiBA,CAACT,OAAe;IAAA,OAAAhB,iBAAA;MAC7C,MAAMN,EAAE,CAACmB,MAAM,CAACa,MAAM,CAACV,OAAO,CAAC;MAC/B,MAAMtB,EAAE,CAACqB,UAAU,CAACY,KAAK,CAAC,SAAS,CAAC,CAACC,MAAM,CAACZ,OAAO,CAAC,CAACU,MAAM,EAAE;IAAC;EAChE;;;uBAjEW/B,YAAY;IAAA;EAAA;;;aAAZA,YAAY;MAAAkC,OAAA,EAAZlC,YAAY,CAAAmC,IAAA;MAAAC,UAAA,EAFX;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}